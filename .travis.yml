if: branch != deploy
cache:
  - pkg
  - cargo
  - node_modules

jobs:
  include:
    - stage: Test_rust
      language: rust
      rust: nightly
      script:
        - cargo check
        - cargo test -- --color always
    - stage: Deploy_rust
      if: branch = main
      language: rust
      rust: nightly
      script:
        - bash bin/deploy-wasm-pack.sh
    - stage: Test_js
      language: node_js
      node_js: "node"
      before_script:
        - make rust-build

notifications:
  email: false
